<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>真實後端測試 - 義大利麵菜單</title>
    
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body { font-family: 'Inter', 'Noto Sans TC', sans-serif; }
    </style>
</head>
<body class="bg-gray-50">

    <div class="container mx-auto max-w-4xl p-4">
        <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">真實後端 API 測試</h1>
        
        <!-- 測試控制面板 -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">義大利麵菜單 OCR 測試</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- 後端狀態 -->
                <div>
                    <h3 class="text-lg font-semibold text-gray-700 mb-3">後端狀態</h3>
                    <div id="backend-status" class="space-y-2">
                        <div class="flex items-center space-x-2">
                            <span class="text-gray-600">健康檢查:</span>
                            <span id="health-status" class="text-gray-500">檢查中...</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="text-gray-600">API 端點:</span>
                            <span id="endpoints-status" class="text-gray-500">檢查中...</span>
                        </div>
                    </div>
                </div>
                
                <!-- OCR 測試 -->
                <div>
                    <h3 class="text-lg font-semibold text-gray-700 mb-3">OCR 功能測試</h3>
                    <div class="space-y-3">
                        <label class="block text-sm font-medium text-gray-700">選擇語言</label>
                        <select id="test-language" class="w-full p-2 border border-gray-300 rounded-md">
                            <option value="zh-TW">中文</option>
                            <option value="en-US">English</option>
                            <option value="ja-JP">日本語</option>
                            <option value="ko-KR">한국어</option>
                        </select>
                        
                        <label class="block text-sm font-medium text-gray-700">上傳菜單圖片</label>
                        <input type="file" id="menu-image" accept="image/*" class="w-full p-2 border border-gray-300 rounded-md">
                        
                        <button id="test-ocr" class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            測試 OCR 辨識
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 測試結果 -->
        <div id="test-results" class="bg-white p-6 rounded-lg shadow-md mb-6 hidden">
            <h2 class="text-xl font-bold text-gray-800 mb-4">測試結果</h2>
            <div id="results-content" class="space-y-4">
                <!-- 測試結果將在這裡顯示 -->
            </div>
        </div>

        <!-- 義大利麵菜單範例 -->
        <div class="bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-xl font-bold text-gray-800 mb-4">義大利麵菜單範例</h2>
            <div class="text-sm text-gray-600 space-y-2">
                <p><strong>奶油白醬系列:</strong></p>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li>經典夏威夷 - NT$ 115</li>
                    <li>鮮蝦鳳梨 - NT$ 125</li>
                    <li>培根玉米 - NT$ 125</li>
                    <li>燻雞蘑菇 - NT$ 135</li>
                    <li>黑椒牛肉 - NT$ 145</li>
                    <li>鮭魚 - NT$ 155</li>
                    <li>蛤蜊 - NT$ 155</li>
                    <li>厚切豬排 - NT$ 165</li>
                    <li>野菇(素) - NT$ 125</li>
                    <li>鮪魚焗烤飯 - NT$ 135</li>
                </ul>
                
                <p class="mt-4"><strong>茄汁紅醬系列:</strong></p>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li>咔滋香腸 - NT$ 135</li>
                    <li>美式辣雞 - NT$ 145</li>
                    <li>泡菜牛肉 - NT$ 155</li>
                    <li>英吉利雞排 - NT$ 155</li>
                    <li>匈牙利雞腿排 - NT$ 165</li>
                    <li>義式海鮮 - NT$ 170</li>
                </ul>
                
                <p class="mt-4"><strong>比薩系列:</strong></p>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li>橙汁鳳梨比薩 - NT$ 80</li>
                    <li>夏威夷比薩 - NT$ 95</li>
                    <li>培根玉米比薩 - NT$ 95</li>
                    <li>燻雞蘑菇比薩 - NT$ 95</li>
                    <li>照燒章魚比薩 - NT$ 95</li>
                    <li>德國香腸比薩 - NT$ 95</li>
                    <li>黑椒牛肉比薩 - NT$ 105</li>
                    <li>鮮蝦鳳梨比薩 - NT$ 115</li>
                    <li>夏威夷鮮蝦比薩 - NT$ 125</li>
                    <li>義式海鮮比薩 - NT$ 135</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'https://ordering-helper-backend-1095766716155.asia-east1.run.app';
        
        // 頁面載入時檢查後端狀態
        document.addEventListener('DOMContentLoaded', async () => {
            await checkBackendStatus();
        });
        
        // 檢查後端狀態
        async function checkBackendStatus() {
            try {
                // 檢查健康狀態
                const healthResponse = await fetch(`${API_BASE_URL}/api/health`);
                const healthData = await healthResponse.json();
                document.getElementById('health-status').textContent = healthData.status === 'healthy' ? '✅ 正常' : '❌ 異常';
                document.getElementById('health-status').className = healthData.status === 'healthy' ? 'text-green-600' : 'text-red-600';
                
                // 檢查端點列表
                const endpointsResponse = await fetch(`${API_BASE_URL}/`);
                const endpointsData = await endpointsResponse.json();
                document.getElementById('endpoints-status').textContent = '✅ 可用';
                document.getElementById('endpoints-status').className = 'text-green-600';
                
            } catch (error) {
                document.getElementById('health-status').textContent = '❌ 連線失敗';
                document.getElementById('health-status').className = 'text-red-600';
                document.getElementById('endpoints-status').textContent = '❌ 無法取得';
                document.getElementById('endpoints-status').className = 'text-red-600';
            }
        }
        
        // OCR 測試
        document.getElementById('test-ocr').addEventListener('click', async () => {
            const fileInput = document.getElementById('menu-image');
            const language = document.getElementById('test-language').value;
            
            if (!fileInput.files[0]) {
                alert('請先選擇一張菜單圖片！');
                return;
            }
            
            const resultsDiv = document.getElementById('test-results');
            const contentDiv = document.getElementById('results-content');
            
            resultsDiv.classList.remove('hidden');
            contentDiv.innerHTML = '<div class="animate-pulse">正在測試 OCR...</div>';
            
            try {
                const formData = new FormData();
                formData.append('image', fileInput.files[0]);
                formData.append('lang', language);
                formData.append('store_id', '999');
                
                const startTime = Date.now();
                const response = await fetch(`${API_BASE_URL}/api/upload-menu-image`, {
                    method: 'POST',
                    body: formData
                });
                const endTime = Date.now();
                
                if (response.ok) {
                    const data = await response.json();
                    
                    contentDiv.innerHTML = `
                        <div class="p-4 bg-green-50 border border-green-200 rounded-lg">
                            <div class="flex items-center space-x-2 mb-3">
                                <span class="text-xl">✅</span>
                                <h3 class="font-semibold text-green-800">OCR 測試成功</h3>
                            </div>
                            <div class="space-y-2 text-sm">
                                <p><strong>處理時間:</strong> ${endTime - startTime}ms</p>
                                <p><strong>語言:</strong> ${language}</p>
                                <p><strong>回應狀態:</strong> ${response.status}</p>
                                <p><strong>辨識結果:</strong></p>
                                <pre class="bg-gray-100 p-2 rounded text-xs overflow-auto">${JSON.stringify(data, null, 2)}</pre>
                            </div>
                        </div>
                    `;
                } else {
                    const errorData = await response.json();
                    contentDiv.innerHTML = `
                        <div class="p-4 bg-red-50 border border-red-200 rounded-lg">
                            <div class="flex items-center space-x-2 mb-3">
                                <span class="text-xl">❌</span>
                                <h3 class="font-semibold text-red-800">OCR 測試失敗</h3>
                            </div>
                            <div class="space-y-2 text-sm">
                                <p><strong>狀態碼:</strong> ${response.status}</p>
                                <p><strong>錯誤訊息:</strong> ${errorData.error || '未知錯誤'}</p>
                                <p><strong>處理時間:</strong> ${endTime - startTime}ms</p>
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                contentDiv.innerHTML = `
                    <div class="p-4 bg-red-50 border border-red-200 rounded-lg">
                        <div class="flex items-center space-x-2 mb-3">
                            <span class="text-xl">❌</span>
                            <h3 class="font-semibold text-red-800">OCR 測試錯誤</h3>
                        </div>
                        <div class="space-y-2 text-sm">
                            <p><strong>錯誤類型:</strong> ${error.name}</p>
                            <p><strong>錯誤訊息:</strong> ${error.message}</p>
                        </div>
                    </div>
                `;
            }
        });
    </script>

</body>
</html> 