<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>語言API整合測試</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-case { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        .log { background-color: #f8f9fa; padding: 10px; margin: 10px 0; border-radius: 3px; font-family: monospace; font-size: 12px; }
        .api-test { margin: 10px 0; padding: 10px; background-color: #f8f9fa; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>語言API整合測試</h1>
    <p>這個測試驗證前端到後端的語言參數傳遞是否正確</p>
    
    <div id="test-results"></div>

    <script>
        // 模擬前端語言代碼轉換邏輯
        function testLanguageCodeConversion() {
            const testCases = [
                {
                    name: "前端完整代碼轉換",
                    frontendLanguage: "en-US",
                    expectedBackend: "en",
                    description: "前端en-US應該轉換為後端en"
                },
                {
                    name: "前端完整代碼轉換",
                    frontendLanguage: "zh-TW",
                    expectedBackend: "zh",
                    description: "前端zh-TW應該轉換為後端zh"
                },
                {
                    name: "前端完整代碼轉換",
                    frontendLanguage: "ja-JP",
                    expectedBackend: "ja",
                    description: "前端ja-JP應該轉換為後端ja"
                },
                {
                    name: "前端完整代碼轉換",
                    frontendLanguage: "ko-KR",
                    expectedBackend: "ko",
                    description: "前端ko-KR應該轉換為後端ko"
                }
            ];

            const results = [];
            
            testCases.forEach(testCase => {
                // 模擬前端語言代碼轉換邏輯
                const backendLanguageMapping = {
                    'en-US': 'en',
                    'zh-TW': 'zh',
                    'ja-JP': 'ja',
                    'ko-KR': 'ko'
                };
                const backendLanguage = backendLanguageMapping[testCase.frontendLanguage] || testCase.frontendLanguage;
                
                results.push({
                    test: testCase.name,
                    frontend: testCase.frontendLanguage,
                    backend: backendLanguage,
                    expected: testCase.expectedBackend,
                    description: testCase.description
                });
            });
            
            return results;
        }

        // 模擬API調用
        function simulateApiCall(endpoint, language) {
            const backendLanguageMapping = {
                'en-US': 'en',
                'zh-TW': 'zh',
                'ja-JP': 'ja',
                'ko-KR': 'ko'
            };
            const backendLanguage = backendLanguageMapping[language] || language;
            
            return {
                endpoint: endpoint,
                frontendLanguage: language,
                backendLanguage: backendLanguage,
                fullUrl: `${endpoint}?lang=${backendLanguage}`
            };
        }

        function runTests() {
            const resultsDiv = document.getElementById('test-results');
            
            // 測試語言代碼轉換
            const conversionResults = testLanguageCodeConversion();
            
            conversionResults.forEach((result, index) => {
                const div = document.createElement('div');
                div.className = 'test-case';
                
                const isSuccess = result.backend === result.expected;
                div.className = `test-case ${isSuccess ? 'success' : 'error'}`;
                
                div.innerHTML = `
                    <h3>測試 ${index + 1}: ${result.test}</h3>
                    <p><strong>描述:</strong> ${result.description}</p>
                    <p><strong>前端語言代碼:</strong> ${result.frontend}</p>
                    <p><strong>轉換後語言代碼:</strong> ${result.backend}</p>
                    <p><strong>預期結果:</strong> ${result.expected}</p>
                    <p><strong>測試結果:</strong> <span style="color: ${isSuccess ? 'green' : 'red'}">${isSuccess ? '✅ 通過' : '❌ 失敗'}</span></p>
                `;
                
                resultsDiv.appendChild(div);
            });
            
            // 測試API調用
            const apiTests = [
                {
                    name: "合作店家菜單API",
                    endpoint: "/api/menu/123",
                    language: "en-US"
                },
                {
                    name: "合作店家菜單API",
                    endpoint: "/api/menu/123",
                    language: "zh-TW"
                },
                {
                    name: "OCR上傳API",
                    endpoint: "/api/upload-menu-image",
                    language: "ja-JP"
                }
            ];
            
            const apiDiv = document.createElement('div');
            apiDiv.className = 'test-case info';
            apiDiv.innerHTML = '<h3>API調用測試</h3>';
            
            apiTests.forEach((test, index) => {
                const apiResult = simulateApiCall(test.endpoint, test.language);
                const apiTestDiv = document.createElement('div');
                apiTestDiv.className = 'api-test';
                apiTestDiv.innerHTML = `
                    <h4>API測試 ${index + 1}: ${test.name}</h4>
                    <p><strong>端點:</strong> ${apiResult.endpoint}</p>
                    <p><strong>前端語言:</strong> ${apiResult.frontendLanguage}</p>
                    <p><strong>後端語言:</strong> ${apiResult.backendLanguage}</p>
                    <p><strong>完整URL:</strong> ${apiResult.fullUrl}</p>
                `;
                apiDiv.appendChild(apiTestDiv);
            });
            
            resultsDiv.appendChild(apiDiv);
            
            // 添加總結
            const summaryDiv = document.createElement('div');
            summaryDiv.className = 'test-case info';
            summaryDiv.innerHTML = `
                <h3>整合測試總結</h3>
                <p>這個測試驗證了前端到後端的語言參數傳遞流程：</p>
                <ol>
                    <li><strong>前端語言偵測</strong>: 自動偵測用戶的LINE語言設定</li>
                    <li><strong>語言代碼轉換</strong>: 將完整代碼（如en-US）轉換為簡短代碼（如en）</li>
                    <li><strong>API參數傳遞</strong>: 確保後端收到正確的語言參數</li>
                    <li><strong>多語言支援</strong>: 支援英文、中文、日文、韓文</li>
                </ol>
                <p><strong>API端點:</strong></p>
                <ul>
                    <li>合作店家菜單: <code>/api/menu/{store_id}?lang={language}</code></li>
                    <li>OCR上傳: <code>/api/upload-menu-image</code> (POST with lang parameter)</li>
                </ul>
                <p><strong>語言代碼對應:</strong></p>
                <ul>
                    <li>前端 en-US → 後端 en</li>
                    <li>前端 zh-TW → 後端 zh</li>
                    <li>前端 ja-JP → 後端 ja</li>
                    <li>前端 ko-KR → 後端 ko</li>
                </ul>
            `;
            resultsDiv.appendChild(summaryDiv);
        }

        // 執行測試
        runTests();
    </script>
</body>
</html>
