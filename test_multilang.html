<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>多語言功能測試</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-8">多語言功能測試</h1>
        
        <!-- 語言測試區塊 -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 class="text-xl font-semibold mb-4">語言協商測試</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">URL 參數測試</label>
                    <div class="space-y-2">
                        <a href="?lang=fr-FR" class="block text-blue-600 hover:underline">法語 (fr-FR)</a>
                        <a href="?lang=de-DE" class="block text-blue-600 hover:underline">德語 (de-DE)</a>
                        <a href="?lang=es-ES" class="block text-blue-600 hover:underline">西班牙語 (es-ES)</a>
                        <a href="?lang=th-TH" class="block text-blue-600 hover:underline">泰語 (th-TH)</a>
                        <a href="?lang=vi-VN" class="block text-blue-600 hover:underline">越南語 (vi-VN)</a>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">支援語言</label>
                    <div class="space-y-2">
                        <a href="?lang=zh-TW" class="block text-green-600 hover:underline">繁體中文 (zh-TW)</a>
                        <a href="?lang=en-US" class="block text-green-600 hover:underline">English (en-US)</a>
                        <a href="?lang=ja-JP" class="block text-green-600 hover:underline">日本語 (ja-JP)</a>
                        <a href="?lang=ko-KR" class="block text-green-600 hover:underline">한국어 (ko-KR)</a>
                    </div>
                </div>
            </div>
            
            <div class="border-t pt-4">
                <p class="text-sm text-gray-600">
                    <strong>當前語言：</strong><span id="current-lang">載入中...</span><br>
                    <strong>瀏覽器語言：</strong><span id="browser-lang"></span><br>
                    <strong>URL 參數：</strong><span id="url-lang"></span>
                </p>
            </div>
        </div>
        
        <!-- 翻譯 API 測試 -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 class="text-xl font-semibold mb-4">翻譯 API 測試</h2>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">測試文字</label>
                <textarea id="test-text" rows="3" class="w-full p-2 border border-gray-300 rounded-md" placeholder="輸入要翻譯的文字">Hello, welcome to our restaurant!</textarea>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">目標語言</label>
                    <select id="target-lang" class="w-full p-2 border border-gray-300 rounded-md">
                        <option value="fr">法語 (fr)</option>
                        <option value="de">德語 (de)</option>
                        <option value="es">西班牙語 (es)</option>
                        <option value="it">義大利語 (it)</option>
                        <option value="pt">葡萄牙語 (pt)</option>
                        <option value="ru">俄語 (ru)</option>
                        <option value="ar">阿拉伯語 (ar)</option>
                        <option value="hi">印地語 (hi)</option>
                        <option value="th">泰語 (th)</option>
                        <option value="vi">越南語 (vi)</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">來源語言</label>
                    <select id="source-lang" class="w-full p-2 border border-gray-300 rounded-md">
                        <option value="en">英語 (en)</option>
                        <option value="zh">中文 (zh)</option>
                        <option value="ja">日語 (ja)</option>
                        <option value="ko">韓語 (ko)</option>
                        <option value="">自動偵測</option>
                    </select>
                </div>
                
                <div class="flex items-end">
                    <button id="translate-btn" class="w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
                        翻譯
                    </button>
                </div>
            </div>
            
            <div id="translation-result" class="hidden">
                <label class="block text-sm font-medium text-gray-700 mb-2">翻譯結果</label>
                <div id="result-text" class="p-3 bg-gray-100 rounded-md"></div>
            </div>
        </div>
        
        <!-- 菜單 API 測試 -->
        <div class="bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-xl font-semibold mb-4">菜單 API 測試</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">店家 ID</label>
                    <input type="number" id="store-id" value="1" class="w-full p-2 border border-gray-300 rounded-md">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">語言</label>
                    <input type="text" id="menu-lang" placeholder="例如: fr-FR, de-DE" class="w-full p-2 border border-gray-300 rounded-md">
                </div>
            </div>
            
            <button id="load-menu-btn" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 mb-4">
                載入菜單
            </button>
            
            <div id="menu-result" class="hidden">
                <label class="block text-sm font-medium text-gray-700 mb-2">菜單結果</label>
                <div id="menu-content" class="p-3 bg-gray-100 rounded-md max-h-96 overflow-y-auto"></div>
            </div>
        </div>
    </div>

    <script>
        // 模擬 translations 物件
        const translations = {
            'zh-TW': { pageTitle: '多語言功能測試' },
            'en-US': { pageTitle: 'Multilanguage Function Test' },
            'ja-JP': { pageTitle: '多言語機能テスト' },
            'ko-KR': { pageTitle: '다국어 기능 테스트' }
        };

        // 語言協商函數
        function pickUserLang() {
            const url = new URLSearchParams(location.search);
            const fromUrl = url.get('lang');
            const browser = navigator.language;

            const map = { 'zh': 'zh-TW', 'en': 'en-US', 'ja': 'ja-JP', 'ko': 'ko-KR' };
            const raw = fromUrl || browser || 'zh-TW';
            const short = raw.split(',')[0].trim();
            const normalized = map[short] || short;
            
            return normalized;
        }

        // 更新語言顯示
        function updateLanguageDisplay() {
            const currentLang = pickUserLang();
            document.getElementById('current-lang').textContent = currentLang;
            document.getElementById('browser-lang').textContent = navigator.language;
            document.getElementById('url-lang').textContent = new URLSearchParams(location.search).get('lang') || '無';
            
            // 更新頁面標題
            const texts = translations[currentLang] || translations['en-US'];
            if (texts && texts.pageTitle) {
                document.title = texts.pageTitle;
            }
        }

        // 翻譯 API 測試
        document.getElementById('translate-btn').addEventListener('click', async () => {
            const text = document.getElementById('test-text').value;
            const target = document.getElementById('target-lang').value;
            const source = document.getElementById('source-lang').value;
            
            if (!text) {
                alert('請輸入要翻譯的文字');
                return;
            }
            
            try {
                const response = await fetch('/api/translate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [text],
                        target: target,
                        source: source || undefined
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`翻譯API錯誤: ${response.status}`);
                }
                
                const data = await response.json();
                document.getElementById('result-text').textContent = data.translated[0];
                document.getElementById('translation-result').classList.remove('hidden');
                
            } catch (error) {
                console.error('翻譯失敗:', error);
                alert(`翻譯失敗: ${error.message}`);
            }
        });

        // 菜單 API 測試
        document.getElementById('load-menu-btn').addEventListener('click', async () => {
            const storeId = document.getElementById('store-id').value;
            const lang = document.getElementById('menu-lang').value || 'zh';
            
            try {
                const response = await fetch(`/api/menu/${storeId}?lang=${lang}`);
                
                if (!response.ok) {
                    throw new Error(`菜單API錯誤: ${response.status}`);
                }
                
                const data = await response.json();
                document.getElementById('menu-content').textContent = JSON.stringify(data, null, 2);
                document.getElementById('menu-result').classList.remove('hidden');
                
            } catch (error) {
                console.error('載入菜單失敗:', error);
                alert(`載入菜單失敗: ${error.message}`);
            }
        });

        // 頁面載入時更新語言顯示
        document.addEventListener('DOMContentLoaded', () => {
            updateLanguageDisplay();
        });

        // URL 變化時更新語言顯示
        window.addEventListener('popstate', updateLanguageDisplay);
    </script>
</body>
</html>
