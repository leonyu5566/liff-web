<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>合作店家修復測試</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        button { padding: 10px 15px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-success { background-color: #28a745; color: white; }
        .btn-warning { background-color: #ffc107; color: black; }
        #ocr-section { margin: 20px 0; padding: 15px; border: 2px solid #ddd; border-radius: 8px; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <h1>合作店家修復測試</h1>
    
    <div class="test-section">
        <h3>測試說明</h3>
        <p>此測試驗證合作店家無菜單模式的修復：</p>
        <ul>
            <li>當店家是合作店家但無菜單時，OCR 標題應該顯示「合作店家（無菜單）」</li>
            <li>當語言切換時，不應該覆蓋這個標題</li>
            <li>非合作店家模式時，標題應該正常更新</li>
        </ul>
    </div>

    <div class="test-section">
        <h3>測試控制</h3>
        <button class="btn-primary" onclick="testPartnerStoreNoMenu()">測試合作店家無菜單</button>
        <button class="btn-warning" onclick="testNonPartnerStore()">測試非合作店家</button>
        <button class="btn-success" onclick="testLanguageSwitch()">測試語言切換</button>
        <button class="btn-primary" onclick="resetTest()">重置測試</button>
    </div>

    <div class="test-section">
        <h3>當前狀態</h3>
        <p>OCR Section Mode: <span id="current-mode">未設定</span></p>
        <p>當前語言: <span id="current-language">zh-TW</span></p>
    </div>

    <div id="ocr-section" class="hidden">
        <h4 id="ocr-title">OCR 標題</h4>
        <p id="ocr-description">OCR 描述</p>
        <button id="custom-upload-btn">📸 選擇菜單照片</button>
    </div>

    <div class="test-section">
        <h3>測試結果</h3>
        <div id="test-results"></div>
    </div>

    <script>
        // 模擬翻譯
        const translations = {
            'zh-TW': {
                ocrTitle: '非合作店家',
                ocrDescription: '請拍攝或上傳菜單照片，我們將為您即時翻譯並建立點餐單。',
                partnerStoreNoMenu: '合作店家（無菜單）',
                partnerStoreNoMenuDesc: '此合作店家目前沒有菜單，請拍攝或上傳菜單照片，我們將為您即時翻譯並建立點餐單。'
            },
            'en-US': {
                ocrTitle: 'Non-Partner Store',
                ocrDescription: 'Please take or upload a clear photo of the menu. We will translate it in real-time and create an order form.',
                partnerStoreNoMenu: 'Partner Store (No Menu)',
                partnerStoreNoMenuDesc: 'This partner store currently has no menu. Please take or upload a clear photo of the menu. We will translate it in real-time and create an order form.'
            }
        };

        let currentLanguage = 'zh-TW';

        function showNonPartnerInterface(storeName = '', isPartnerStore = false) {
            const ocrSection = document.getElementById('ocr-section');
            ocrSection.classList.remove('hidden');
            
            // 設定模式旗標，避免被 updateInterfaceLanguage 覆蓋
            ocrSection.dataset.mode = isPartnerStore ? 'partner-no-menu' : 'non-partner';
            
            // 更新模式顯示
            document.getElementById('current-mode').textContent = ocrSection.dataset.mode;
            
            // 根據店家狀態更新標題和描述
            const ocrTitle = document.getElementById('ocr-title');
            const ocrDescription = document.getElementById('ocr-description');
            const texts = translations[currentLanguage] || translations['zh-TW'];
            
            if (isPartnerStore) {
                ocrTitle.textContent = texts.partnerStoreNoMenu;
                ocrDescription.textContent = texts.partnerStoreNoMenuDesc;
            } else {
                ocrTitle.textContent = texts.ocrTitle;
                ocrDescription.textContent = texts.ocrDescription;
            }
        }

        function updateInterfaceLanguage() {
            const texts = translations[currentLanguage] || translations['zh-TW'];
            
            // 更新 OCR 介面（根據模式決定是否覆蓋）
            const ocrSection = document.getElementById('ocr-section');
            if (ocrSection && ocrSection.dataset.mode !== 'partner-no-menu') {
                // 只有在非合作店家無菜單模式時才覆蓋標題和描述
                document.getElementById('ocr-title').textContent = texts.ocrTitle;
                document.getElementById('ocr-description').textContent = texts.ocrDescription;
            }
            
            // 更新語言顯示
            document.getElementById('current-language').textContent = currentLanguage;
        }

        function testPartnerStoreNoMenu() {
            showNonPartnerInterface('食肆鍋 14 Pot', true);
            addTestResult('✅ 合作店家無菜單模式設定成功', 'success');
            addTestResult(`標題: ${document.getElementById('ocr-title').textContent}`, 'success');
        }

        function testNonPartnerStore() {
            showNonPartnerInterface('一般店家', false);
            addTestResult('✅ 非合作店家模式設定成功', 'success');
            addTestResult(`標題: ${document.getElementById('ocr-title').textContent}`, 'success');
        }

        function testLanguageSwitch() {
            // 切換語言
            currentLanguage = currentLanguage === 'zh-TW' ? 'en-US' : 'zh-TW';
            updateInterfaceLanguage();
            
            const ocrSection = document.getElementById('ocr-section');
            const mode = ocrSection.dataset.mode;
            const title = document.getElementById('ocr-title').textContent;
            
            if (mode === 'partner-no-menu') {
                // 合作店家無菜單模式：標題應該保持不變
                const expectedTitle = translations[currentLanguage].partnerStoreNoMenu;
                if (title === expectedTitle) {
                    addTestResult(`✅ 語言切換成功，合作店家標題保持正確: ${title}`, 'success');
                } else {
                    addTestResult(`❌ 語言切換後標題錯誤，期望: ${expectedTitle}，實際: ${title}`, 'error');
                }
            } else {
                // 非合作店家模式：標題應該更新
                const expectedTitle = translations[currentLanguage].ocrTitle;
                if (title === expectedTitle) {
                    addTestResult(`✅ 語言切換成功，非合作店家標題更新正確: ${title}`, 'success');
                } else {
                    addTestResult(`❌ 語言切換後標題錯誤，期望: ${expectedTitle}，實際: ${title}`, 'error');
                }
            }
        }

        function resetTest() {
            document.getElementById('ocr-section').classList.add('hidden');
            document.getElementById('current-mode').textContent = '未設定';
            document.getElementById('test-results').innerHTML = '';
            addTestResult('🔄 測試已重置', 'success');
        }

        function addTestResult(message, type) {
            const resultsDiv = document.getElementById('test-results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-section ${type}`;
            resultDiv.textContent = message;
            resultsDiv.appendChild(resultDiv);
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            addTestResult('🚀 測試頁面已載入，請開始測試', 'success');
        });
    </script>
</body>
</html>
